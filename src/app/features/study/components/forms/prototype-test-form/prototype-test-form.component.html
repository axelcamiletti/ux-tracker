<div class="header border-b border-gray-200 flex items-center gap-3 px-8 py-4 mb-4">
  <div class="icon rounded-lg bg-pink-700 text-white flex justify-center items-center h-10 w-10">
    <mat-icon>edit</mat-icon>
  </div>
  <h2 class="text-xl font-bold">Prototype Test</h2>
  <mat-icon class="opacity-50" matTooltip="A mission is a task for testers to complete. Create your mission by setting the title, description, and expected path to success.">info</mat-icon>
  <button mat-icon-button class="ml-auto" [matMenuTriggerFor]="menu">
    <mat-icon>more_horiz</mat-icon>
  </button>
</div>

<div class="form p-8">
  <!-- Task and Description -->
  <label class="label">Task *</label>
  <mat-form-field appearance="outline" class="w-full">
    <input matInput placeholder="Write a short sentence that summarizes the task" required [(ngModel)]="title" (ngModelChange)="updateTitle($event)" type="text" />
    <mat-error>A title is required to create this block.</mat-error>
  </mat-form-field>

  <label class="label">Description</label>
  <mat-form-field appearance="outline" class="w-full">
    <textarea matInput placeholder="Give tester details to complete the mission" [(ngModel)]="description" (ngModelChange)="updateSubtitle($event)"></textarea>
  </mat-form-field>

  <!-- Prototype Link Section - Se oculta cuando hay frames exportados -->
  <div *ngIf="!exportedImages.length">
    <p class="mt-4"><b>Prototype link *</b></p>
    <div class="flex my-2">
      <input type="text" [(ngModel)]="fileId" (ngModelChange)="onUrlChange($event)" placeholder="Pega tu link de Figma" class="border border-gray-300 px-2 w-full">
      <button mat-flat-button (click)="extractFramesAsImages()" [disabled]="!importEnabled || isLoading">IMPORT</button>
    </div>
    <p class="text-xs text-gray-600">Set your prototype permissions to <b>Anyone</b> and <b>can view</b></p>

    <div class="border border-gray-300 rounded-lg flex items-center gap-3 p-3 mt-2" *ngIf="figmaFileName">
      <img src="https://app.maze.co/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Ffigma-logo-icon.f470507a.png&w=48&q=75" alt="">
      <div>{{ figmaFileName }}</div>
    </div>

    <mat-progress-bar *ngIf="isLoading" mode="indeterminate" class="mt-2"></mat-progress-bar>
  </div>

  <!-- Prototype Navigation Section - Se muestra cuando hay frames exportados -->
  <div *ngIf="exportedImages.length" class="mt-4">
    <!-- Start Screen -->
    <div class="mb-6">
      <p class="mb-2"><b>Start screen</b></p>
      <div class="btn-icon border border-gray-300 rounded-lg flex items-center gap-3 p-3">
        <div class="image-container border border-gray-300 overflow-hidden rounded-md h-16 w-16 flex justify-center items-center">
          <img *ngIf="startScreenImage" [src]="startScreenImage.imageUrl" alt="Start frame" class="object-cover"/>
          <mat-icon *ngIf="!startScreenImage">play_circle</mat-icon>
        </div>
        <div class="texts">
          <p class="text-lg text-gray-900 font-medium">{{ startScreenImage?.name || 'Loading...' }}</p>
        </div>
      </div>
    </div>

    <!-- Goal-based Target Screen -->
    <div>
      <p class="mb-2"><b>Target screen</b></p>
      <p class="text-sm text-gray-600 mb-2">Success criteria: Reach a specific screen</p>
      <div class="btn-icon border border-gray-300 rounded-lg flex items-center gap-3 p-3">
        <div class="image-container border border-gray-300 overflow-hidden rounded-md h-16 w-16 flex justify-center items-center">
          <img *ngIf="selectedImage" [src]="selectedImage.imageUrl" alt="Target frame" class="object-contain"/>
          <mat-icon *ngIf="!selectedImage">add</mat-icon>
        </div>
        <div class="texts">
          <p *ngIf="!selectedImage" class="text-md text-gray-600">Select a screen</p>
          <p *ngIf="selectedImage" class="text-lg font-medium">{{selectedImage.name}}</p>
        </div>
        <button mat-icon-button class="ml-auto" (click)="selectedImage = null" *ngIf="selectedImage">
          <mat-icon>edit</mat-icon>
        </button>
      </div>
    </div>

    <!-- Frame Selection Grid -->
    <div *ngIf="!selectedImage" class="mt-4">
      <div class="flex flex-wrap gap-2">
        <div *ngFor="let image of exportedImages" (click)="selectImage(image)" class="image-item w-40 border border-gray-300 rounded-lg overflow-hidden cursor-pointer hover:border-blue-500">
          <div class="image-container h-32 overflow-hidden">
            <img [src]="image.imageUrl" alt="Exported frame" class="object-cover" />
          </div>
          <div class="body p-2 text-sm font-medium">{{ image.name }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<mat-menu #menu="matMenu">
</mat-menu>
